@model IEnumerable<BurstroyMonitoring.Data.Models.VwSensorResultsFull>

@{
    ViewData["Title"] = "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–∞—Ç—á–∏–∫–æ–≤";
}

<div class="view-container">
    <h1 class="view-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–∞—Ç—á–∏–∫–æ–≤</h1>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="search-container">
        <form method="get" class="search-form">
            <div class="search-row">
                <input type="text" name="search" value="@ViewBag.Search" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–∏–π–Ω–æ–º—É –Ω–æ–º–µ—Ä—É, –æ—Ç–≤–µ—Ç—É..." 
                       class="input search-input" />
                <button type="submit" class="button button--primary">–ù–∞–π—Ç–∏</button>
                <a href="@Url.Action("Index")" class="button button--secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                <label style="display: inline-flex; align-items: center; gap: 8px; margin-left: 16px; cursor: pointer;">
                    <input type="checkbox" id="autoRefresh" style="width: 16px; height: 16px; margin: 0; accent-color: #0052cc;" />
                    <span style="font-size: 14px; color: #172b4d;">–û–±–Ω–æ–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
                </label>

            </div>
        </form>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–≤–µ—Ä—Ö—É -->
    @await Html.PartialAsync("_Pagination")

    <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>
                        <a href="@Url.Action("Index", new { 
                            page = ViewBag.Page, 
                            pageSize = ViewBag.PageSize, 
                            search = ViewBag.Search,
                            sortBy = "ResultId",
                            sortDesc = ViewBag.SortBy == "ResultId" ? !ViewBag.SortDesc : true
                        })">
                            ID
                            @if (ViewBag.SortBy == "ResultId")
                            {
                                <span>@(ViewBag.SortDesc ? "‚ñº" : "‚ñ≤")</span>
                            }
                        </a>
                    </th>
                    <th>–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏</th>
                    <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                    <th>–ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞</th>
                    <th>–ö–æ–¥ —Å—Ç–∞—Ç—É—Å–∞</th>
                    <th>–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.ResultId</td>
                        <td>@item.CheckedAt?.ToLocalTime().ToString("dd.MM.yyyy HH:mm:ss")</td>
                        <td>@item.SerialNumber</td>
                        <td>@item.EndpointName</td>
                        <td>
                            @if (item.StatusCode.HasValue)
                            {
                                <span>@item.StatusCode</span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (item.ResponseTimeMs.HasValue)
                            {
                                <span>@item.ResponseTimeMs.Value.ToString("N0") –º—Å</span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (item.IsSuccess.HasValue)
                            {
                                @if (item.IsSuccess == true)
                                {
                                    <span class="lozenge lozenge--success">–£—Å–ø–µ—à–Ω–æ</span>
                                }
                                else
                                {
                                    <span class="lozenge lozenge--error">–û—à–∏–±–∫–∞</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Details" asp-route-id="@item.ResultId" 
                               class="button button--sm button--secondary" title="–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π">
                                üìä
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–Ω–∏–∑—É -->
    @await Html.PartialAsync("_Pagination")

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π -->
    <div class="records-info">
        –ü–æ–∫–∞–∑–∞–Ω–æ @(((ViewBag.Page - 1) * ViewBag.PageSize) + 1)-@Math.Min(ViewBag.Page * ViewBag.PageSize, ViewBag.TotalCount) 
        –∏–∑ @ViewBag.TotalCount –∑–∞–ø–∏—Å–µ–π
    </div>
</div>