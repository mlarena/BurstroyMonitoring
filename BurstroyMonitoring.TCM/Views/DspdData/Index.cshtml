@model IEnumerable<BurstroyMonitoring.Data.Models.VwDspdDataFull>

@{
    ViewData["Title"] = "–î–∞–Ω–Ω—ã–µ DSPD";
}

<div class="view-container">
    <h1 class="view-title">–î–∞–Ω–Ω—ã–µ DSPD</h1>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="search-container">
        <form method="get" class="search-form">
            <div class="search-row">
                <input type="text" name="search" value="@ViewBag.Search" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–∏–π–Ω–æ–º—É –Ω–æ–º–µ—Ä—É, –Ω–∞–∑–≤–∞–Ω–∏—é —Ç–æ—á–∫–∏..." 
                       class="input search-input" />
                <button type="submit" class="button button--primary">–ù–∞–π—Ç–∏</button>
                <a href="@Url.Action("Index")" class="button button--secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                <a href="@Url.Action("DataViewer")" class="button button--secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —ç–∫—Å–ø–æ—Ä—Ç</a>
                <label style="display: inline-flex; align-items: center; gap: 8px; margin-left: 16px; cursor: pointer;">
                    <input type="checkbox" id="autoRefresh" style="width: 16px; height: 16px; margin: 0; accent-color: #0052cc;" />
                    <label>–û–±–Ω–æ–≤–ª—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</label>
                </label>
            </div>
        </form>
        

    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–≤–µ—Ä—Ö—É -->
    @await Html.PartialAsync("_Pagination")

    <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>
                        <a href="@Url.Action("Index", new { 
                            page = ViewBag.Page, 
                            pageSize = ViewBag.PageSize, 
                            search = ViewBag.Search,
                            sortBy = "DspdDataId",
                            sortDesc = ViewBag.SortBy == "DspdDataId" ? !ViewBag.SortDesc : true
                        })">
                            ID
                            @if (ViewBag.SortBy == "DspdDataId")
                            {
                                <span>@(ViewBag.SortDesc ? "‚ñº" : "‚ñ≤")</span>
                            }
                        </a>
                    </th>
                    <th>–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</th>
                    <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                    <th>–ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞</th>
                    <th>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ—Ä–æ–≥–∏</th>
                    <th>–°—Ü–µ–ø–ª–µ–Ω–∏–µ</th>
                    <th>–í–æ–¥–∞/–õ–µ–¥/–°–Ω–µ–≥</th>
                    <th>GPS</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.DspdDataId</td>
                        <td>@item.ReceivedAt?.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                        <td>@item.SerialNumber</td>
                        <td>@item.EndpointName</td>
                        <td>
                            @if (item.RoadTemperature.HasValue)
                            {
                                <span>@item.RoadTemperature.Value.ToString("F1")¬∞C</span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (item.GripCoefficient.HasValue)
                            {
                                <span>@item.GripCoefficient.Value.ToString("F2")</span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (item.WaterHeight.HasValue || item.IceHeight.HasValue || item.SnowHeight.HasValue)
                            {
                                <span title="–í–æ–¥–∞: @(item.WaterHeight?.ToString("F1") ?? "0") –º–º, –õ–µ–¥: @(item.IceHeight?.ToString("F1") ?? "0") –º–º, –°–Ω–µ–≥: @(item.SnowHeight?.ToString("F1") ?? "0") –º–º">
                                    @(item.WaterHeight?.ToString("F1") ?? "0")/
                                    @(item.IceHeight?.ToString("F1") ?? "0")/
                                    @(item.SnowHeight?.ToString("F1") ?? "0") –º–º
                                </span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (item.GpsValid.HasValue)
                            {
                                @if (item.GpsValid == true)
                                {
                                    <span class="lozenge lozenge--success" title="GPS –≤–∞–ª–∏–¥–µ–Ω">‚úì</span>
                                }
                                else
                                {
                                    <span class="lozenge lozenge--error" title="GPS –Ω–µ–≤–∞–ª–∏–¥–µ–Ω">‚úó</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (item.CalibrationNeeded.HasValue)
                            {
                                @if (item.CalibrationNeeded == 1)
                                {
                                    <span class="lozenge lozenge--error" title="–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞">‚ö†Ô∏è</span>
                                }
                                else
                                {
                                    <span class="lozenge lozenge--success" title="OK">‚úì</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Details" asp-route-id="@item.DspdDataId" 
                               class="button button--sm button--secondary" title="–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π">
                                üìä
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–Ω–∏–∑—É -->
    @await Html.PartialAsync("_Pagination")

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π -->
    <div class="records-info">
        –ü–æ–∫–∞–∑–∞–Ω–æ @(((ViewBag.Page - 1) * ViewBag.PageSize) + 1)-@Math.Min(ViewBag.Page * ViewBag.PageSize, ViewBag.TotalCount) 
        –∏–∑ @ViewBag.TotalCount –∑–∞–ø–∏—Å–µ–π
    </div>
</div>
@section Scripts {
    
    <script src="~/js/autoRefresh.js"></script>
    
}