@model IEnumerable<BurstroyMonitoring.Data.Models.VwSensorErrorsFull>

@{
    ViewData["Title"] = "–û—à–∏–±–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤";
}

<div class="view-container">
    <h1 class="view-title">–û—à–∏–±–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤</h1>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
    <div class="search-container">
        <form method="get" class="search-form">
            <div class="search-row">
                <input type="text" name="search" value="@ViewBag.Search" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é, —Ç–∏–ø—É –æ—à–∏–±–∫–∏, —Å–µ—Ä–∏–π–Ω–æ–º—É –Ω–æ–º–µ—Ä—É..." 
                       class="input search-input" />
                <button type="submit" class="button button--primary">–ù–∞–π—Ç–∏</button>
                <a href="@Url.Action("Index")" class="button button--secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </div>
        </form>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–≤–µ—Ä—Ö—É -->
    @await Html.PartialAsync("_Pagination")

    <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö -->
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>
                        <a href="@Url.Action("Index", new { 
                            page = ViewBag.Page, 
                            pageSize = ViewBag.PageSize, 
                            search = ViewBag.Search,
                            sortBy = "ErrorId",
                            sortDesc = ViewBag.SortBy == "ErrorId" ? !ViewBag.SortDesc : true
                        })">
                            ID
                            @if (ViewBag.SortBy == "ErrorId")
                            {
                                <span>@(ViewBag.SortDesc ? "‚ñº" : "‚ñ≤")</span>
                            }
                        </a>
                    </th>
                    <th>–î–∞—Ç–∞ –æ—à–∏–±–∫–∏</th>
                    <th>–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</th>
                    <th>–ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞</th>
                    <th>–£—Ä–æ–≤–µ–Ω—å</th>
                    <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                    <th>–¢–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è</th>
                    <th>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.ErrorId</td>
                        <td>@item.ErrorCreatedAt?.ToLocalTime().ToString("dd.MM.yyyy HH:mm:ss")</td>
                        <td>@item.SerialNumber</td>
                        <td>@item.EndpointName</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.ErrorLevel))
                            {
                                <span class="lozenge">@item.ErrorLevel</span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.ErrorMessage))
                            {
                                <span title="@item.ErrorMessage">
                                    @(item.ErrorMessage.Length > 50 ? item.ErrorMessage.Substring(0, 50) + "..." : item.ErrorMessage)
                                </span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.ExceptionType))
                            {
                                <span>@item.ExceptionType</span>
                            }
                            else
                            {
                                <span class="text-muted">-</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Details" asp-route-id="@item.ErrorId" 
                               class="button button--sm button--secondary" title="–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π">
                                üìä
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–Ω–∏–∑—É -->
    @await Html.PartialAsync("_Pagination")

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π -->
    <div class="records-info">
        –ü–æ–∫–∞–∑–∞–Ω–æ @(((ViewBag.Page - 1) * ViewBag.PageSize) + 1)-@Math.Min(ViewBag.Page * ViewBag.PageSize, ViewBag.TotalCount) 
        –∏–∑ @ViewBag.TotalCount –∑–∞–ø–∏—Å–µ–π
    </div>
</div>