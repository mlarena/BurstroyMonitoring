@model BurstroyMonitoring.Data.Models.VwDovDataFull

@{
    ViewData["Title"] = "–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ –¥–∞–Ω–Ω—ã—Ö DOV";
}

<div class="details-container">
    <h1 class="form-title">–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ –¥–∞–Ω–Ω—ã—Ö DOV</h1>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è (–≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è) -->
    <div class="details-section">
        <h3 class="details-section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

        <div class="details-table">
            <!-- –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã -->
            <!--
            <div class="details-row details-row--header">
                <div class="details-label">–ü–∞—Ä–∞–º–µ—Ç—Ä</div>
                <div class="details-value">–ó–Ω–∞—á–µ–Ω–∏–µ</div>
            </div>
            -->

            <!-- –î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è -->
            <div class="details-row details-row--primary">
                <div class="details-label">–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</div>
                <div class="details-value">
                    @if (Model.ReceivedAt.HasValue)
                    {
                        <span>@Model.ReceivedAt.Value.ToString("dd.MM.yyyy HH:mm:ss")</span>
                    }
                    else
                    {
                        <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                    }
                </div>
            </div>

            <!-- –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä -->
            <div class="details-row details-row--primary">
                <div class="details-label">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</div>
                <div class="details-value">
                    @if (!string.IsNullOrEmpty(Model.SerialNumber))
                    {
                        <span class="highlight-value">@Model.SerialNumber</span>
                    }
                    else
                    {
                        <span class="text-muted">-</span>
                    }
                </div>
            </div>

            <!-- –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ -->
            <div class="details-row details-row--primary">
                <div class="details-label">–ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞</div>
                <div class="details-value">
                    @if (!string.IsNullOrEmpty(Model.EndpointName))
                    {
                        <span class="highlight-value">@Model.EndpointName</span>
                    }
                    else
                    {
                        <span class="text-muted">-</span>
                    }
                </div>
            </div>

            <!-- –í–∏–¥–∏–º–æ—Å—Ç—å -->
            <div class="details-row details-row--primary">
                <div class="details-label">–í–∏–¥–∏–º–æ—Å—Ç—å</div>
                <div class="details-value">
                    @if (Model.VisibleRange.HasValue)
                    {
                        <span class="highlight-value">@Model.VisibleRange.Value.ToString("F0") –º</span>
                    }
                    else
                    {
                        <span class="text-muted">-</span>
                    }
                </div>
            </div>

            <!-- –§–ª–∞–≥ —è—Ä–∫–æ—Å—Ç–∏ -->
            <div class="details-row details-row--primary">
                <div class="details-label">–§–ª–∞–≥ —è—Ä–∫–æ—Å—Ç–∏</div>
                <div class="details-value">
                    @if (Model.BrightFlag.HasValue)
                    {
                        @if (Model.BrightFlag == 1)
                        {
                            <span class="lozenge lozenge--success highlight-value">–Ø—Ä–∫–æ</span>
                        }
                        else
                        {
                            <span class="lozenge highlight-value">–ù–æ—Ä–º–∞</span>
                        }
                    }
                    else
                    {
                        <span class="text-muted">-</span>
                    }
                </div>
            </div>

            <!-- URL –¥–∞—Ç—á–∏–∫–∞ -->
            <div class="details-row details-row--primary">
                <div class="details-label">URL –¥–∞—Ç—á–∏–∫–∞</div>
                <div class="details-value">
                    @if (!string.IsNullOrEmpty(Model.SensorUrl))
                    {
                        <a href="@Model.SensorUrl" target="_blank" class="highlight-link">
                            @Model.SensorUrl
                        </a>
                    }
                    else
                    {
                        <span class="text-muted">-</span>
                    }
                </div>
            </div>

            <!-- –¢–∏–ø –¥–∞—Ç—á–∏–∫–∞ -->
            <div class="details-row details-row--primary">
                <div class="details-label">–¢–∏–ø –¥–∞—Ç—á–∏–∫–∞</div>
                <div class="details-value">
                    @if (!string.IsNullOrEmpty(Model.SensorTypeName))
                    {
                        <span>@Model.SensorTypeName</span>
                    }
                    else
                    {
                        <span class="text-muted">-</span>
                    }
                </div>
            </div>

            <!-- –ü–æ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
            <div class="details-row details-row--primary">
                <div class="details-label">–ü–æ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</div>
                <div class="details-value">
                    @if (!string.IsNullOrEmpty(Model.PostName))
                    {
                        <span>@Model.PostName</span>
                    }
                    else
                    {
                        <span class="text-muted">–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω</span>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–µ) -->
    <div class="details-section">
        <button type="button" id="toggleAdditionalBtn" class="button button--sm button--secondary toggle-section-btn"
                onclick="toggleAdditionalFields()" style="margin-bottom: 15px;">
            üìÑ –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        </button>

        <div id="additionalFields" style="display: none;">
            <h3 class="details-section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

            <div class="details-table">
                <!-- ID –¥–∞–Ω–Ω—ã—Ö -->
                <div class="details-row">
                    <div class="details-label">ID –¥–∞–Ω–Ω—ã—Ö</div>
                    <div class="details-value">@Model.DovDataId</div>
                </div>

                <!-- –ú–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–∞–Ω–Ω—ã—Ö -->
                <div class="details-row">
                    <div class="details-label">–ú–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–∞–Ω–Ω—ã—Ö</div>
                    <div class="details-value">
                        @if (Model.DataTimestamp.HasValue)
                        {
                            <span>@Model.DataTimestamp.Value.ToString("dd.MM.yyyy HH:mm:ss")</span>
                        }
                        else
                        {
                            <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                        }
                    </div>
                </div>

                <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞—Ç—á–∏–∫–∞ -->
                <div class="details-row">
                    <div class="details-label">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞—Ç—á–∏–∫–∞</div>
                    <div class="details-value">
                        @if (!string.IsNullOrEmpty(Model.SensorTypeDescription))
                        {
                            <span>@Model.SensorTypeDescription</span>
                        }
                        else
                        {
                            <span class="text-muted">-</span>
                        }
                    </div>
                </div>

                <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ -->
                <div class="details-row">
                    <div class="details-label">–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å—Ç–∞</div>
                    <div class="details-value">
                        @if (!string.IsNullOrEmpty(Model.PostDescription))
                        {
                            <span>@Model.PostDescription</span>
                        }
                        else
                        {
                            <span class="text-muted">-</span>
                        }
                    </div>
                </div>

                <!-- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–∞—Ç—á–∏–∫–∞ -->
                <div class="details-row">
                    <div class="details-label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–∞—Ç—á–∏–∫–∞</div>
                    <div class="details-value">
                        @if (Model.SensorLongitude.HasValue && Model.SensorLatitude.HasValue)
                        {
                            <span>@Model.SensorLongitude.Value.ToString("F6"), @Model.SensorLatitude.Value.ToString("F6")</span>
                            <br />
                            <small>
                                <a href="https://www.google.com/maps?q=@Model.SensorLatitude.Value,@Model.SensorLongitude.Value"
                                   target="_blank" style="color: var(--primary-color); text-decoration: none;">
                                    üìç –û—Ç–∫—Ä—ã—Ç—å –≤ Google Maps
                                </a>
                            </small>
                        }
                        else
                        {
                            <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω—ã</span>
                        }
                    </div>
                </div>

                <!-- –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
                <div class="details-row">
                    <div class="details-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
                    <div class="details-value">
                        @if (Model.CheckIntervalSeconds.HasValue)
                        {
                            <span>@Model.CheckIntervalSeconds —Å–µ–∫—É–Ω–¥</span>
                            <small style="color: var(--text-secondary); margin-left: 8px;">
                                (@(Model.CheckIntervalSeconds / 60) –º–∏–Ω—É—Ç)
                            </small>
                        }
                        else
                        {
                            <span class="text-muted">-</span>
                        }
                    </div>
                </div>

                <!-- –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
                <div class="details-row">
                    <div class="details-label">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                    <div class="details-value">
                        @if (Model.LastActivityUtc.HasValue)
                        {
                            <span>@Model.LastActivityUtc.Value.ToString("dd.MM.yyyy HH:mm:ss") UTC</span>
                            <br />
                            <small style="color: var(--text-secondary);">
                                @{
                                    var timeAgo = DateTime.UtcNow - Model.LastActivityUtc.Value;
                                    if (timeAgo.TotalDays >= 1)
                                    {
                                        <span>@((int)timeAgo.TotalDays) –¥–Ω–µ–π –Ω–∞–∑–∞–¥</span>
                                    }
                                    else if (timeAgo.TotalHours >= 1)
                                    {
                                        <span>@((int)timeAgo.TotalHours) —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥</span>
                                    }
                                    else if (timeAgo.TotalMinutes >= 1)
                                    {
                                        <span>@((int)timeAgo.TotalMinutes) –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥</span>
                                    }
                                    else
                                    {
                                        <span>–¢–æ–ª—å–∫–æ —á—Ç–æ</span>
                                    }
                                }
                            </small>
                        }
                        else
                        {
                            <span class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                        }
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç—É—Å –¥–∞—Ç—á–∏–∫–∞ -->
                <div class="details-row">
                    <div class="details-label">–°—Ç–∞—Ç—É—Å –¥–∞—Ç—á–∏–∫–∞</div>
                    <div class="details-value">
                        @if (Model.SensorIsActive.HasValue)
                        {
                            @if (Model.SensorIsActive == true)
                            {
                                <span class="lozenge lozenge--success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            }
                            else
                            {
                                <span class="lozenge lozenge--error">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                            }
                        }
                        else
                        {
                            <span class="text-muted">-</span>
                        }
                    </div>
                </div>

                <!-- –¢–∏–ø –ø–æ—Å—Ç–∞ -->
                <div class="details-row">
                    <div class="details-label">–¢–∏–ø –ø–æ—Å—Ç–∞</div>
                    <div class="details-value">
                        @if (Model.PostIsMobile.HasValue)
                        {
                            @if (Model.PostIsMobile == true)
                            {
                                <span class="lozenge">–ú–æ–±–∏–ª—å–Ω—ã–π</span>
                            }
                            else
                            {
                                <span class="lozenge">–°—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π</span>
                            }
                        }
                        else
                        {
                            <span class="text-muted">-</span>
                        }
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç—É—Å –ø–æ—Å—Ç–∞ -->
                <div class="details-row">
                    <div class="details-label">–°—Ç–∞—Ç—É—Å –ø–æ—Å—Ç–∞</div>
                    <div class="details-value">
                        @if (Model.PostIsActive.HasValue)
                        {
                            @if (Model.PostIsActive == true)
                            {
                                <span class="lozenge lozenge--success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            }
                            else
                            {
                                <span class="lozenge lozenge--error">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                            }
                        }
                        else
                        {
                            <span class="text-muted">-</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="details-actions">
        <a asp-action="Index" class="button button--secondary">–ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
    </div>
</div>

@section Scripts {
    <script>
        let isAdditionalExpanded = false;

        function toggleAdditionalFields() {
            const additionalFields = document.getElementById('additionalFields');
            const toggleBtn = document.getElementById('toggleAdditionalBtn');

            if (!isAdditionalExpanded) {
                additionalFields.style.display = 'block';
                toggleBtn.textContent = 'üìÑ –°–∫—Ä—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                isAdditionalExpanded = true;
            } else {
                additionalFields.style.display = 'none';
                toggleBtn.textContent = 'üìÑ –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                isAdditionalExpanded = false;
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        });
    </script>

}