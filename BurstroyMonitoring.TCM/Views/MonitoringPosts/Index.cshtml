@model IEnumerable<BurstroyMonitoring.Data.Models.MonitoringPost>

@{
    ViewData["Title"] = "–ü–æ—Å—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞";
    
    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏–∑ ViewBag
    var sortBy = ViewBag.SortBy as string ?? "Id";
    var sortDesc = ViewBag.SortDesc as bool? ?? true;
    var search = ViewBag.Search as string ?? "";
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    string GetSortUrl(string columnName)
    {
        var newSortDesc = (sortBy == columnName) ? !sortDesc : true;
        return Url.Action("Index", new { 
            sortBy = columnName, 
            sortDesc = newSortDesc,
            search = search
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    string GetSortArrow(string columnName)
    {
        if (sortBy == columnName)
        {
            return sortDesc ? "‚ñº" : "‚ñ≤";
        }
        return "";
    }
}

<div class="view-container">
    <h1 class="view-title">–ü–æ—Å—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h1>
    
    <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ -->
    <div class="search-container">
        <form method="get" class="search-form">
            <div class="search-row">
                <input type="text" name="search" value="@search" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..." 
                       class="input search-input" />
                <button type="submit" class="button button--primary">–ù–∞–π—Ç–∏</button>
                @if (!string.IsNullOrEmpty(search))
                {
                    <a href="@Url.Action("Index")" class="button button--secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                }
            </div>
            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
            <input type="hidden" name="sortBy" value="@sortBy" />
            <input type="hidden" name="sortDesc" value="@sortDesc.ToString()" />
        </form>
    </div>
    
    <div class="table-header">
        <a asp-action="Create" class="button button--primary">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π</a>
        
        @if (Model.Any())
        {
            <div class="records-count">
                –í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤: @Model.Count()
                @if (!string.IsNullOrEmpty(search))
                {
                    <span> (–ø–æ –∑–∞–ø—Ä–æ—Å—É: "@search")</span>
                }
            </div>
        }
    </div>

    <div class="table-responsive">
        <table class="table table--wide">
            <thead>
                <tr>
                    <th>
                        <a href="@GetSortUrl("Name")" style="color: inherit; text-decoration: none;">
                            –ù–∞–∑–≤–∞–Ω–∏–µ @GetSortArrow("Name")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("Description")" style="color: inherit; text-decoration: none;">
                            –û–ø–∏—Å–∞–Ω–∏–µ @GetSortArrow("Description")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("Coordinates")" style="color: inherit; text-decoration: none;">
                            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã @GetSortArrow("Coordinates")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("Type")" style="color: inherit; text-decoration: none;">
                            –¢–∏–ø @GetSortArrow("Type")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("Status")" style="color: inherit; text-decoration: none;">
                            –°—Ç–∞—Ç—É—Å @GetSortArrow("Status")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("Created")" style="color: inherit; text-decoration: none;">
                            –°–æ–∑–¥–∞–Ω @GetSortArrow("Created")
                        </a>
                    </th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td title="@item.Name">
                            @if (item.Name.Length > 20)
                            {
                                @item.Name.Substring(0, 20)<text>...</text>
                            }
                            else
                            {
                                @item.Name
                            }
                        </td>
                        <td class="long-text-cell" title="@item.Description">
                            @if (!string.IsNullOrEmpty(item.Description) && item.Description.Length > 30)
                            {
                                @item.Description.Substring(0, 30)<text>...</text>
                            }
                            else if (!string.IsNullOrEmpty(item.Description))
                            {
                                @item.Description
                            }
                            else
                            {
                                <span class="text-muted">‚Äî</span>
                            }
                        </td>
                        <td>
                            @if (item.Longitude.HasValue && item.Latitude.HasValue)
                            {
                                <span title="@item.Longitude.Value.ToString("F6"), @item.Latitude.Value.ToString("F6")">
                                    @item.Longitude.Value.ToString("F2"), @item.Latitude.Value.ToString("F2")
                                </span>
                            }
                            else
                            {
                                <span class="text-muted">‚Äî</span>
                            }
                        </td>
                        <td>
                            @if (item.IsMobile)
                            {
                                <span class="lozenge" title="–ú–æ–±–∏–ª—å–Ω—ã–π –ø–æ—Å—Ç">–ú–æ–±.</span>
                            }
                            else
                            {
                                <span class="lozenge" title="–°—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π –ø–æ—Å—Ç">–°—Ç–∞—Ü.</span>
                            }
                        </td>
                        <td>
                            @if (item.IsActive)
                            {
                                <span class="lozenge lozenge--success" title="–ê–∫—Ç–∏–≤–µ–Ω">‚úì</span>
                            }
                            else
                            {
                                <span class="lozenge lozenge--error" title="–ù–µ–∞–∫—Ç–∏–≤–µ–Ω">‚úó</span>
                            }
                        </td>
                        <td>
                            @if (item.CreatedAt.HasValue)
                            {
                                <span title="@item.CreatedAt.Value.ToString("dd.MM.yyyy HH:mm:ss")">
                                    @item.CreatedAt.Value.ToString("dd.MM.yyyy HH:mm")
                                </span>
                            }
                            else
                            {
                                <span class="text-muted">‚Äî</span>
                            }
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a asp-action="Edit" asp-route-id="@item.Id" 
                                   class="button button--sm button--secondary" 
                                   title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç">
                                    ‚úèÔ∏è
                                </a>
                                <a asp-action="Details" asp-route-id="@item.Id" 
                                   class="button button--sm button--secondary" 
                                   title="–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ –ø–æ—Å—Ç–µ">
                                    üìÑ
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.Id" 
                                   class="button button--sm button--danger" 
                                   title="–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç">
                                    üóëÔ∏è
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    
    @if (!Model.Any())
    {
        <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <h3>@(string.IsNullOrEmpty(search) ? "–ù–µ—Ç –ø–æ—Å—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞" : "–ü–æ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")</h3>
            <p>@(string.IsNullOrEmpty(search) ? "–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É" : "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞")</p>
            <a asp-action="Create" class="button button--primary">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a>
            @if (!string.IsNullOrEmpty(search))
            {
                <a href="@Url.Action("Index")" class="button button--secondary" style="margin-left: 10px;">
                    –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                </a>
            }
        </div>
    }
</div>

