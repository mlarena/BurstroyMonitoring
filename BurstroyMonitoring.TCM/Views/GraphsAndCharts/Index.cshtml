@model BurstroyMonitoring.Data.Models.ViewModels.SensorSelectionViewModel

@{
    ViewData["Title"] = "Графики и диаграммы";
}
<link rel="stylesheet" href="~/css/charts.css" asp-append-version="true" />

<div class="view-container" style="max-width: 100%;">
    <h1 class="view-title">Графики и диаграммы</h1>
    
    <div class="filter-container">
        <div class="filter-content">
            <form id="sensorForm" class="filter-form">
                <div class="form-row">
                    <div class="field-group" style="flex: 1;">
                        <label for="monitoringPostSelect">Пост мониторинга</label>
                        <select id="monitoringPostSelect" class="input select" 
                                asp-for="SelectedMonitoringPostId" 
                                asp-items="Model.MonitoringPosts">
                            <option value="">-- Выберите пост --</option>
                        </select>
                    </div>
                    <div class="field-group" style="flex: 1;">
                        <label for="sensorSelect">Сенсор</label>
                        <select id="sensorSelect" class="input select" 
                                asp-for="SelectedSensorId" 
                                asp-items="Model.Sensors" disabled>
                            <option value="">-- Сначала выберите пост --</option>
                        </select>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="sensorDataContainer" class="w-100" style="margin-top: var(--spacing-lg);">
        <!-- Здесь будут отображаться данные выбранного сенсора -->
    </div>
</div>

@section Scripts {
    <script src="~/js/lib/chart.js"></script>
    
    <script>
        $(document).ready(function () {
            // Каскадные списки
            $('#monitoringPostSelect').change(function () {
                var postId = $(this).val();
                
                if (postId) {
                    $('#sensorSelect').prop('disabled', false);
                    
                    $.getJSON('/GraphsAndCharts/GetSensorsByPost', { monitoringPostId: postId }, function (data) {
                        $('#sensorSelect').empty();
                       
                        $.each(data, function (index, item) {
                            $('#sensorSelect').append($('<option>', {
                                value: item.value,
                                text: item.text
                            }));
                        });
                    });
                } else {
                    $('#sensorSelect').prop('disabled', true).empty();
                    $('#sensorSelect').append($('<option>', {
                        value: "",
                        text: "-- Сначала выберите пост мониторинга --"
                    }));
                    $('#sensorDataContainer').empty();
                }
            });

            // Загрузка данных сенсора
            $('#sensorSelect').change(function () {
                var sensorId = $(this).val();
                
                if (sensorId) {
                    $.get('/GraphsAndCharts/GetSensorData', { sensorId: sensorId }, function (data) {
                        $('#sensorDataContainer').html(data);
                    });
                } else {
                    $('#sensorDataContainer').empty();
                }
            });
        });
    </script>
}