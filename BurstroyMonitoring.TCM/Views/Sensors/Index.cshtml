@model IEnumerable<BurstroyMonitoring.Data.Models.Sensor>

@{
    ViewData["Title"] = "–î–∞—Ç—á–∏–∫–∏";
    
    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –ø–æ–∏—Å–∫–∞
    var sortBy = ViewBag.SortBy as string ?? "Id";
    var sortDesc = ViewBag.SortDesc as bool? ?? true;
    var search = ViewBag.Search as string ?? "";
    
    // –§–∏–ª—å—Ç—Ä—ã
    var selectedSensorTypeId = ViewBag.SelectedSensorTypeId as int?;
    var selectedMonitoringPostId = ViewBag.SelectedMonitoringPostId as int?;
    var selectedSensorTypeIds = ViewBag.SelectedSensorTypeIds as List<int> ?? new List<int>();
    var selectedMonitoringPostIds = ViewBag.SelectedMonitoringPostIds as List<int> ?? new List<int>();
    
    var hasSensorTypeFilter = selectedSensorTypeId.HasValue || selectedSensorTypeIds.Any();
    var hasMonitoringPostFilter = selectedMonitoringPostId.HasValue || selectedMonitoringPostIds.Any();
    
    var selectedSensorTypeNames = new List<string>();
    var selectedMonitoringPostNames = new List<string>();
    
    if (ViewBag.SensorTypes != null)
    {
        foreach (var type in ViewBag.SensorTypes)
        {
            if (selectedSensorTypeIds.Contains(type.SensorTypeId) || 
                (selectedSensorTypeId.HasValue && selectedSensorTypeId.Value == type.SensorTypeId))
            {
                selectedSensorTypeNames.Add(type.SensorTypeName);
            }
        }
    }
    
    if (ViewBag.MonitoringPosts != null)
    {
        foreach (var post in ViewBag.MonitoringPosts)
        {
            if (selectedMonitoringPostIds.Contains(post.MonitoringPostId) || 
                (selectedMonitoringPostId.HasValue && selectedMonitoringPostId.Value == post.MonitoringPostId))
            {
                selectedMonitoringPostNames.Add(post.Name);
            }
        }
    }
    
    var filterNamesText = "";
    if (selectedSensorTypeNames.Any())
    {
        filterNamesText += "–¢–∏–ø—ã: " + string.Join(", ", selectedSensorTypeNames);
    }
    if (selectedMonitoringPostNames.Any())
    {
        if (!string.IsNullOrEmpty(filterNamesText))
            filterNamesText += "; ";
        filterNamesText += "–ü–æ—Å—Ç—ã: " + string.Join(", ", selectedMonitoringPostNames);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    string GetSortUrl(string columnName)
    {
        var urlParams = new Dictionary<string, string>
        {
            ["sortBy"] = columnName,
            ["sortDesc"] = ((sortBy == columnName) ? !sortDesc : true).ToString(),
            ["search"] = search
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        if (selectedSensorTypeId.HasValue)
            urlParams["sensorTypeId"] = selectedSensorTypeId.Value.ToString();
        
        if (selectedMonitoringPostId.HasValue)
            urlParams["monitoringPostId"] = selectedMonitoringPostId.Value.ToString();
        
        foreach (var id in selectedSensorTypeIds)
            urlParams["selectedSensorTypes"] = id.ToString();
            
        foreach (var id in selectedMonitoringPostIds)
            urlParams["selectedMonitoringPosts"] = id.ToString();
        
        return Url.Action("Index", urlParams);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–µ–ª–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    string GetSortArrow(string columnName)
    {
        if (sortBy == columnName)
        {
            return sortDesc ? "‚ñº" : "‚ñ≤";
        }
        return "";
    }
}

<div class="view-container">
    <h1 class="view-title">–î–∞—Ç—á–∏–∫–∏</h1>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ -->
    <div class="search-container">
        <div class="search-filters-row">
            <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ -->
            <form method="get" class="search-form" style="flex: 1;">
                <div class="search-row">
                    <input type="text" name="search" value="@search" 
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–∏–π–Ω–æ–º—É –Ω–æ–º–µ—Ä—É, –Ω–∞–∑–≤–∞–Ω–∏—é..." 
                           class="input search-input" />
                    <button type="submit" class="button button--primary">–ù–∞–π—Ç–∏</button>
                    @if (!string.IsNullOrEmpty(search))
                    {
                        <a href="@Url.Action("Index")" class="button button--secondary">–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∏—Å–∫</a>
                    }
                </div>
                <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                <input type="hidden" name="sortBy" value="@sortBy" />
                <input type="hidden" name="sortDesc" value="@sortDesc.ToString()" />
                @if (selectedSensorTypeId.HasValue)
                {
                    <input type="hidden" name="sensorTypeId" value="@selectedSensorTypeId.Value" />
                }
                @if (selectedMonitoringPostId.HasValue)
                {
                    <input type="hidden" name="monitoringPostId" value="@selectedMonitoringPostId.Value" />
                }
                @foreach (var id in selectedSensorTypeIds)
                {
                    <input type="hidden" name="selectedSensorTypes" value="@id" />
                }
                @foreach (var id in selectedMonitoringPostIds)
                {
                    <input type="hidden" name="selectedMonitoringPosts" value="@id" />
                }
            </form>

            <!-- –ö–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="filter-buttons" style="display: flex; gap: 8px; margin-left: 16px;">
                <!-- –§–∏–ª—å—Ç—Ä –¢–∏–ø—ã –¥–∞—Ç—á–∏–∫–æ–≤ -->
                <div class="filter-trigger-group">
                    <button type="button" class="button @(hasSensorTypeFilter ? "button--primary" : "button--secondary")" 
                            onclick="toggleFilter('sensorTypesFilter')">
                        –¢–∏–ø—ã –¥–∞—Ç—á–∏–∫–æ–≤
                        @if (hasSensorTypeFilter)
                        {
                            <span class="filter-badge">@(selectedSensorTypeIds.Count + (selectedSensorTypeId.HasValue ? 1 : 0))</span>
                        }
                    </button>
                    <div class="filter-dropdown" id="sensorTypesFilter">
                        <div class="filter-dropdown-header">
                            <span>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø—ã –¥–∞—Ç—á–∏–∫–æ–≤</span>
                            <button type="button" class="filter-dropdown-close" 
                                    onclick="closeFilter('sensorTypesFilter')" title="–ó–∞–∫—Ä—ã—Ç—å">
                                ‚úï
                            </button>
                        </div>
                        <div class="checkbox-group">
                            @if (ViewBag.SensorTypes != null)
                            {
                                foreach (var type in ViewBag.SensorTypes)
                                {
                                    var isChecked = selectedSensorTypeIds.Contains(type.SensorTypeId) || 
                                                   (selectedSensorTypeId.HasValue && selectedSensorTypeId.Value == type.SensorTypeId);
                                    <div class="checkbox-item">
                                        <input type="checkbox" 
                                               name="selectedSensorTypes" 
                                               value="@type.SensorTypeId" 
                                               id="sensorType_@type.SensorTypeId"
                                               @(isChecked ? "checked" : "")
                                               onchange="applyFilter()" />
                                        <label for="sensorType_@type.SensorTypeId">@type.SensorTypeName</label>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä –ü–æ—Å—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
                <div class="filter-trigger-group">
                    <button type="button" class="button @(hasMonitoringPostFilter ? "button--primary" : "button--secondary")" 
                            onclick="toggleFilter('monitoringPostsFilter')">
                        –ü–æ—Å—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
                        @if (hasMonitoringPostFilter)
                        {
                            <span class="filter-badge">@(selectedMonitoringPostIds.Count + (selectedMonitoringPostId.HasValue ? 1 : 0))</span>
                        }
                    </button>
                    <div class="filter-dropdown" id="monitoringPostsFilter">
                        <div class="filter-dropdown-header">
                            <span>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</span>
                            <button type="button" class="filter-dropdown-close" 
                                    onclick="closeFilter('monitoringPostsFilter')" title="–ó–∞–∫—Ä—ã—Ç—å">
                                ‚úï
                            </button>
                        </div>
                        <div class="checkbox-group">
                            @if (ViewBag.MonitoringPosts != null)
                            {
                                foreach (var post in ViewBag.MonitoringPosts)
                                {
                                    var isChecked = selectedMonitoringPostIds.Contains(post.MonitoringPostId) || 
                                                   (selectedMonitoringPostId.HasValue && selectedMonitoringPostId.Value == post.MonitoringPostId);
                                    <div class="checkbox-item">
                                        <input type="checkbox" 
                                               name="selectedMonitoringPosts" 
                                               value="@post.MonitoringPostId" 
                                               id="post_@post.MonitoringPostId"
                                               @(isChecked ? "checked" : "")
                                               onchange="applyFilter()" />
                                        <label for="post_@post.MonitoringPostId">@post.Name</label>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                @if (hasSensorTypeFilter || hasMonitoringPostFilter || !string.IsNullOrEmpty(search))
                {
                    <a href="@Url.Action("Index")" class="button button--secondary">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</a>
                }
            </div>
        </div>
        
        @if (!string.IsNullOrEmpty(filterNamesText))
        {
            <div class="active-filters-info">
                <small class="filter-info" title="@filterNamesText">
                    @filterNamesText
                </small>
            </div>
        }
    </div>

    <div class="table-header">
        <a asp-action="Create" class="button button--primary">–î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—á–∏–∫</a>
        
        @if (ViewBag.AllSensorCount != null)
        {
            <div class="records-count">
                –ü–æ–∫–∞–∑–∞–Ω–æ: @Model.Count() –∏–∑ @ViewBag.AllSensorCount –¥–∞—Ç—á–∏–∫–æ–≤
                @if (!string.IsNullOrEmpty(search))
                {
                    <span> (–ø–æ –∑–∞–ø—Ä–æ—Å—É: "@search")</span>
                }
            </div>
        }
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö -->
    <div class="table-responsive">
        <table class="table table--wide">
            <thead>
                <tr>
                    <th>
                        <a href="@GetSortUrl("SerialNumber")" style="color: inherit; text-decoration: none;">
                            –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä @GetSortArrow("SerialNumber")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("SensorType")" style="color: inherit; text-decoration: none;">
                            –¢–∏–ø –¥–∞—Ç—á–∏–∫–∞ @GetSortArrow("SensorType")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("MonitoringPost")" style="color: inherit; text-decoration: none;">
                            –ü–æ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ @GetSortArrow("MonitoringPost")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("Url")" style="color: inherit; text-decoration: none;">
                            URL @GetSortArrow("Url")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("IsActive")" style="color: inherit; text-decoration: none;">
                            –ê–∫—Ç–∏–≤–µ–Ω @GetSortArrow("IsActive")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("LastActivity")" style="color: inherit; text-decoration: none;">
                            –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å @GetSortArrow("LastActivity")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("CheckInterval")" style="color: inherit; text-decoration: none;">
                            –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Å–µ–∫) @GetSortArrow("CheckInterval")
                        </a>
                    </th>
                    <th>
                        <a href="@GetSortUrl("Created")" style="color: inherit; text-decoration: none;">
                            –°–æ–∑–¥–∞–Ω @GetSortArrow("Created")
                        </a>
                    </th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>

        <tbody>
            @foreach (var item in Model)
            {
                <tr class="@(item.IsActive ? "row-active" : "row-inactive")">
                    <td title="@item.SerialNumber">
                        @if (item.SerialNumber.Length > 15)
                        {
                            @item.SerialNumber.Substring(0, 15)<text>...</text>
                        }
                        else
                        {
                            @item.SerialNumber
                        }
                    </td>
                    <td>
                        @if (item.SensorType != null)
                        {
                            <a href="@Url.Action("Index", new { sensorTypeId = item.SensorTypeId, sortBy = sortBy, sortDesc = sortDesc, search = search })"
                            class="sensor-type-link" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–∞—Ç—á–∏–∫–∏ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞">
                                @item.SensorType.SensorTypeName
                            </a>
                        }
                        else
                        {
                            <span class="text-muted">‚Äî</span>
                        }
                    </td>
                    <td>
                        @if (item.MonitoringPost != null)
                        {
                            <a href="@Url.Action("Index", new { monitoringPostId = item.MonitoringPostId, sortBy = sortBy, sortDesc = sortDesc, search = search })"
                            class="post-link" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–∞—Ç—á–∏–∫–∏ —ç—Ç–æ–≥–æ –ø–æ—Å—Ç–∞">
                                @item.MonitoringPost.Name
                                @if (item.MonitoringPost.IsMobile)
                                {
                                    <span class="lozenge" style="margin-left: 4px; font-size: 11px;">–ú–æ–±.</span>
                                }
                            </a>
                        }
                        else
                        {
                            <span class="text-muted">‚Äî</span>
                        }
                    </td>
                   <td class="long-text-cell" title="@item.Url">
                        @if (!string.IsNullOrEmpty(item.Url))
                        {
                            var url = item.Url;
                            var protocol = url.StartsWith("https://") ? "https://" : (url.StartsWith("http://") ? "http://" : "");
                            var rest = url.Substring(protocol.Length);
                            var domainEndIndex = rest.IndexOf('/');
                            var domainPart = domainEndIndex >= 0 ? rest.Substring(0, domainEndIndex) : rest;
                            var pathPart = domainEndIndex >= 0 ? rest.Substring(domainEndIndex) : "";

                            var colorClass = item.IsActive ? "url-active" : "url-inactive";

                            <a href="@item.Url" target="_blank" class="sensor-url-link @colorClass">
                                <span class="url-protocol">@protocol</span>
                                <strong class="url-domain">@domainPart</strong>
                                <span class="url-path">@pathPart</span>
                            </a>
                        }
                        else
                        {
                            <span class="text-muted">‚Äî</span>
                        }
                </td>
                    <td>
                        @if (item.IsActive)
                        {
                            <span class="lozenge lozenge--success" title="–ê–∫—Ç–∏–≤–µ–Ω">‚úì</span>
                        }
                        else
                        {
                            <span class="lozenge lozenge--error" title="–ù–µ–∞–∫—Ç–∏–≤–µ–Ω">‚úó</span>
                        }
                    </td>
                    <td>
                        @if (item.LastActivityUTC.HasValue)
                        {
                            var timeAgo = DateTime.UtcNow - item.LastActivityUTC.Value;
                            string timeText;

                            if (timeAgo.TotalDays >= 1)
                            {
                                timeText = $"{(int)timeAgo.TotalDays} –¥–Ω. –Ω–∞–∑–∞–¥";
                            }
                            else if (timeAgo.TotalHours >= 1)
                            {
                                timeText = $"{(int)timeAgo.TotalHours} —á. –Ω–∞–∑–∞–¥";
                            }
                            else if (timeAgo.TotalMinutes >= 1)
                            {
                                timeText = $"{(int)timeAgo.TotalMinutes} –º–∏–Ω. –Ω–∞–∑–∞–¥";
                            }
                            else
                            {
                                timeText = "–¢–æ–ª—å–∫–æ —á—Ç–æ";
                            }

                            <span title="@item.LastActivityUTC.Value.ToString("dd.MM.yyyy HH:mm:ss") UTC">
                                @timeText
                            </span>
                        }
                        else
                        {
                            <span class="text-muted" title="–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö">‚Äî</span>
                        }
                    </td>
                    <td>
                        <span title="@item.CheckIntervalSeconds —Å–µ–∫—É–Ω–¥">
                            @item.CheckIntervalSeconds
                            <small style="color: var(--text-secondary);">—Å–µ–∫</small>
                        </span>
                    </td>
                    <td>
                        @if (item.CreatedAt.HasValue)
                        {
                            <span title="@item.CreatedAt.Value.ToString("dd.MM.yyyy HH:mm:ss") UTC">
                                @item.CreatedAt.Value.ToString("dd.MM.yyyy HH:mm")
                            </span>
                        }
                        else
                        {
                            <span class="text-muted">‚Äî</span>
                        }
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a asp-action="Edit" asp-route-id="@item.Id"                            class="button button--sm button--secondary"                            title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç—á–∏–∫">
                                ‚úèÔ∏è
                            </a>
                            <a asp-action="Details" asp-route-id="@item.Id"                            class="button button--sm button--secondary"                            title="–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –æ –¥–∞—Ç—á–∏–∫–µ">
                                üìÑ
                            </a>
                            <a asp-action="Delete" asp-route-id="@item.Id"                            class="button button--sm button--danger"                            title="–£–¥–∞–ª–∏—Ç—å –¥–∞—Ç—á–∏–∫">
                                üóëÔ∏è
                            </a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
        
        </table>
    </div>
    
    @if (!Model.Any())
    {
        <div class="empty-state">
            <div class="empty-state-icon">üì°</div>
            <h3>@(hasSensorTypeFilter || hasMonitoringPostFilter || !string.IsNullOrEmpty(search) ? "–î–∞—Ç—á–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã" : "–ù–µ—Ç –¥–∞—Ç—á–∏–∫–æ–≤")</h3>
            <p>@(hasSensorTypeFilter || hasMonitoringPostFilter || !string.IsNullOrEmpty(search) ? "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã" : "–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –¥–∞—Ç—á–∏–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞")</p>
            <a asp-action="Create" class="button button--primary">–°–æ–∑–¥–∞—Ç—å –¥–∞—Ç—á–∏–∫</a>
            @if (hasSensorTypeFilter || hasMonitoringPostFilter || !string.IsNullOrEmpty(search))
            {
                <a href="@Url.Action("Index")" class="button button--secondary" style="margin-left: 10px;">
                    –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                </a>
            }
        </div>
    }
</div>

<script>
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    let activeDropdown = null;

    function toggleFilter(filterId) {
        const dropdown = document.getElementById(filterId);
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥—Ä—É–≥–∏–µ dropdown
        closeAllDropdowns();
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π dropdown
        dropdown.classList.add('show');
        activeDropdown = dropdown;
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.body.style.overflow = 'hidden';
    }

    function closeFilter(filterId) {
        const dropdown = document.getElementById(filterId);
        dropdown.classList.remove('show');
        
        if (activeDropdown === dropdown) {
            activeDropdown = null;
        }
        
        if (!document.querySelector('.filter-dropdown.show')) {
            document.body.style.overflow = '';
        }
    }

    function closeAllDropdowns() {
        document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
            dropdown.classList.remove('show');
        });
        
        activeDropdown = null;
        document.body.style.overflow = '';
    }

    function applyFilter() {
        const form = document.querySelector('.search-form');
        const formData = new FormData(form);
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–∞—Ç—á–∏–∫–æ–≤
        const sensorTypeCheckboxes = document.querySelectorAll('input[name="selectedSensorTypes"]:checked');
        sensorTypeCheckboxes.forEach(checkbox => {
            formData.append('selectedSensorTypes', checkbox.value);
        });
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        const monitoringPostCheckboxes = document.querySelectorAll('input[name="selectedMonitoringPosts"]:checked');
        monitoringPostCheckboxes.forEach(checkbox => {
            formData.append('selectedMonitoringPosts', checkbox.value);
        });
        
        // –°–æ–∑–¥–∞–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        const params = new URLSearchParams();
        for (const [key, value] of formData.entries()) {
            if (value) {
                params.append(key, value);
            }
        }
        
        const queryString = params.toString();
        const newUrl = queryString ? '@Url.Action("Index")?' + queryString : '@Url.Action("Index")';
        
        window.location.href = newUrl;
    }

    document.addEventListener('DOMContentLoaded', function() {
        // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ –æ–±–ª–∞—Å—Ç–∏
        document.addEventListener('click', function(event) {
            if (activeDropdown && !activeDropdown.contains(event.target) && 
                !event.target.closest('.filter-trigger-group .button')) {
                closeAllDropdowns();
            }
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAllDropdowns();
            }
        });
    });
</script>